# 系统要求

本文档描述了运行 Scintirete 的系统要求和推荐配置。

## 📋 基本要求

### 操作系统支持

Scintirete 支持以下操作系统：

| 操作系统 | 架构 | 最低版本 | 推荐版本 |
|---------|------|---------|---------|
| **Linux** | x86_64 | Ubuntu 18.04, CentOS 7 | Ubuntu 20.04+, CentOS 8+ |
| **Linux** | ARM64 | Ubuntu 18.04, CentOS 7 | Ubuntu 20.04+, CentOS 8+ |
| **Linux** | ARM v7 | Raspberry Pi OS (32-bit) | Raspberry Pi OS (latest) |
| **Linux** | ARM v6 | Raspberry Pi OS (32-bit) | Raspberry Pi OS (latest) |
| **macOS** | x86_64 | macOS 10.15 (Catalina) | macOS 12.0+ (Monterey) |
| **macOS** | ARM64 (M1/M2) | macOS 11.0 (Big Sur) | macOS 12.0+ (Monterey) |
| **Windows** | x86_64 | Windows 10 | Windows 11 |

### 🍓 树莓派专项支持

Scintirete 为树莓派设备提供了原生优化支持：

| 树莓派型号 | CPU 架构 | 支持的操作系统 | 二进制包 | Docker 架构 |
|-----------|----------|---------------|----------|-------------|
| **Pi 1, Zero, Zero W** | ARMv6 (32-bit) | Raspberry Pi OS (32-bit) | `scintirete-linux-arm-pi1.tar.gz` | `linux/arm/v6` |
| **Pi 2 (Rev 1.1)** | ARMv7 (32-bit) | Raspberry Pi OS (32-bit) | `scintirete-linux-arm-pi23.tar.gz` | `linux/arm/v7` |
| **Pi 3, 4, 5, Zero 2W** | ARMv8 (64-bit capable) | Raspberry Pi OS (32-bit) | `scintirete-linux-arm-pi23.tar.gz` | `linux/arm/v7` |
| **Pi 3, 4, 5, Zero 2W** | ARMv8 (AArch64) | Raspberry Pi OS (64-bit) | `scintirete-linux-arm64-pi45.tar.gz` | `linux/arm64` |

**树莓派性能参考：**
- **Pi 4 (4GB+)**: 适合中小型向量数据库（< 100万向量）
- **Pi 5 (8GB)**: 适合较大规模部署（100万+ 向量）
- **Pi Zero 系列**: 适合边缘计算和原型验证
- **推荐存储**: microSD 卡（Class 10 或 A1/A2），或 USB 3.0 SSD

### 硬件要求

#### 最低配置
- **CPU**: 1 核心 (x86_64、ARM64、ARMv7 或 ARMv6)
- **内存**: 512 MB RAM
- **存储**: 100 MB 可用磁盘空间
- **网络**: 支持 TCP/IP

#### 推荐配置
- **CPU**: 2+ 核心 (x86_64、ARM64、ARMv7)
- **内存**: 2 GB+ RAM
- **存储**: 1 GB+ SSD 存储
- **网络**: 千兆以太网

#### 树莓派特定配置建议

| 树莓派型号 | 推荐内存配置 | 适合的数据规模 | 存储建议 |
|-----------|-------------|---------------|----------|
| **Pi 1, Zero, Zero W** | 512MB (系统限制) | < 10万向量 | microSD Class 10 |
| **Pi 2** | 1GB (系统限制) | < 50万向量 | microSD Class 10 + USB 存储 |
| **Pi 3** | 1GB (系统限制) | < 50万向量 | microSD Class 10 + USB 3.0 SSD |
| **Pi 4 (4GB)** | 4GB | < 100万向量 | USB 3.0 SSD 推荐 |
| **Pi 4 (8GB)** | 8GB | 100万+ 向量 | USB 3.0 SSD 推荐 |
| **Pi 5 (4GB/8GB)** | 4GB/8GB | 100万+ 向量 | USB 3.0 SSD 或 NVMe |

## 🧮 内存计算指南

### 向量存储内存需求

Scintirete 将所有向量数据存储在内存中以保证最佳性能。内存需求主要由以下因素决定：

```
总内存需求 = 向量数据 + HNSW 索引 + 元数据 + 系统开销
```

#### 向量数据内存

```
向量数据内存 = 向量数量 × 向量维度 × 4 字节 (float32)
```

**示例计算**：
- 100万个 768 维向量：1,000,000 × 768 × 4 = ~2.9 GB
- 100万个 1536 维向量：1,000,000 × 1536 × 4 = ~5.7 GB

#### HNSW 索引内存

HNSW 索引通常需要额外的 30-50% 内存开销：

```
索引内存 ≈ 向量数据内存 × 0.3 到 0.5
```

#### 完整内存估算表

| 向量数量 | 维度 | 向量数据 | 索引开销 | 推荐总内存 |
|---------|------|---------|---------|-----------|
| 10,000 | 768 | ~29 MB | ~12 MB | 512 MB |
| 100,000 | 768 | ~290 MB | ~120 MB | 1 GB |
| 1,000,000 | 768 | ~2.9 GB | ~1.2 GB | 8 GB |
| 10,000,000 | 768 | ~29 GB | ~12 GB | 64 GB |
| 1,000,000 | 1536 | ~5.7 GB | ~2.3 GB | 16 GB |

### 内存优化建议

1. **预留内存**: 为系统和其他进程预留至少 25% 的内存
2. **分批导入**: 大量数据分批导入，避免内存峰值
3. **监控使用**: 使用 `/metrics` 接口监控内存使用情况
4. **定期重建**: 定期重建索引以清理标记删除的向量

## 🔧 运行时依赖

### 无外部依赖

Scintirete 是一个**静态编译的单二进制文件**，无需安装额外的运行时依赖：

- ✅ **无需 Python 环境**
- ✅ **无需 Go 运行时**
- ✅ **无需数据库软件**
- ✅ **无需复杂的系统库**

### 可选依赖（用于集成功能）

| 功能 | 依赖 | 说明 |
|------|------|------|
| **Docker 部署** | Docker 20.10+ | 容器化部署 |
| **监控集成** | Prometheus, Grafana | 可观测性栈 |
| **文本向量化** | OpenAI API 或兼容服务 | 自动文本嵌入 |
| **反向代理** | Nginx, Traefik 等 | 生产环境负载均衡 |

## 🌐 网络要求

### 端口配置

| 端口 | 协议 | 用途 | 默认值 | 可配置 |
|------|------|------|--------|--------|
| **HTTP API** | TCP | RESTful API 服务 | 8080 | ✅ |
| **gRPC** | TCP | gRPC 服务 | 9090 | ✅ |
| **指标监控** | TCP | Prometheus 指标 | 8080 (内置) | ❌ |

### 防火墙配置

**最小配置**（仅本地访问）：
```bash
# 允许本地回环访问
sudo ufw allow from 127.0.0.1
```

**内网服务配置**：
```bash
# 允许内网访问 HTTP API
sudo ufw allow from 192.168.0.0/16 to any port 8080

# 允许内网访问 gRPC
sudo ufw allow from 192.168.0.0/16 to any port 9090
```

**公网服务配置**（不推荐，请使用反向代理和 TLS）：
```bash
# 谨慎：只在有适当安全措施时开放公网访问
sudo ufw allow 8080
sudo ufw allow 9090
```

### 外部网络需求

如果使用文本向量化功能，需要访问 OpenAI API，请自行配置 `base_url` 和 `api_key`

## 💾 存储要求

### 磁盘空间规划

```
总存储需求 = 数据文件 + 日志文件 + 配置文件 + 系统开销
```

#### 数据存储估算

| 组件 | 存储需求 | 说明 |
|------|---------|------|
| **RDB 快照** | ~内存数据大小 | 压缩后的数据快照 |
| **AOF 日志** | 可变 | 操作日志，可配置轮转 |
| **元数据** | < 1% 数据大小 | 集合、数据库元信息 |
| **系统日志** | 可配置 | 结构化日志和审计日志 |

#### 存储配置建议

| 数据规模 | 推荐存储 | 存储类型 | IOPS 要求 |
|---------|---------|---------|----------|
| **< 1GB 数据** | 10 GB | SSD | 基本 |
| **1-10GB 数据** | 100 GB | SSD | 中等 |
| **10-100GB 数据** | 1 TB | NVMe SSD | 高 |
| **> 100GB 数据** | 数据大小 × 3 | 企业级 SSD | 非常高 |

### 文件系统建议

| 操作系统 | 推荐文件系统 | 备选方案 |
|---------|-------------|----------|
| **Linux** | ext4, XFS | Btrfs, ZFS |
| **macOS** | APFS | HFS+ |
| **Windows** | NTFS | ReFS |

## 🔒 安全要求

### 网络安全

1. **防火墙**: 配置适当的防火墙规则
2. **TLS**: 生产环境使用 HTTPS/TLS
3. **认证**: 配置强密码或密钥认证
4. **网络隔离**: 将数据库服务放置在受保护的网络段

### 文件系统权限

```bash
# 创建专用用户（推荐）
sudo useradd -r -s /bin/false scintirete

# 设置数据目录权限
sudo mkdir -p /var/lib/scintirete
sudo chown scintirete:scintirete /var/lib/scintirete
sudo chmod 750 /var/lib/scintirete

# 设置配置文件权限
sudo chmod 640 /etc/scintirete/scintirete.toml
sudo chown root:scintirete /etc/scintirete/scintirete.toml
```

## 🚀 性能调优

### 系统级优化

#### Linux 系统参数

```bash
# 增加文件描述符限制
echo "* soft nofile 65536" >> /etc/security/limits.conf
echo "* hard nofile 65536" >> /etc/security/limits.conf

# 优化内存管理
echo 'vm.swappiness = 1' >> /etc/sysctl.conf
echo 'vm.dirty_ratio = 15' >> /etc/sysctl.conf
echo 'vm.dirty_background_ratio = 5' >> /etc/sysctl.conf

# 应用配置
sysctl -p
```

#### Docker 优化

```bash
# 限制容器内存（防止 OOM）
docker run -m 4g scintirete/scintirete:latest

# 使用本地 SSD 卷
docker run -v /fast-ssd/scintirete:/app/data scintirete/scintirete:latest
```

### 应用级优化

1. **HNSW 参数调优**: 参考 [HNSW 超参数调整](使用指南/3_HNSW_超参数调整.md)
2. **批量操作**: 使用批量插入和搜索接口
3. **连接池**: 客户端使用连接池管理连接
4. **监控调优**: 基于 Prometheus 指标调整配置

## 📊 环境验证

### 系统信息检查

```bash
# 检查系统基本信息
uname -a
cat /etc/os-release

# 检查硬件资源
free -h              # 内存
df -h               # 磁盘空间
lscpu               # CPU 信息
```

### 网络连通性测试

```bash
# 测试端口可用性
netstat -tuln | grep 8080
netstat -tuln | grep 9090

# 测试网络延迟
ping your-scintirete-server
```

## 🔧 部署模式对比

| 部署模式 | 适用场景 | 资源要求 | 复杂度 |
|---------|----------|---------|--------|
| **单机二进制** | 开发、测试、小规模生产 | 最低 | 简单 |
| **Docker 容器** | 标准化部署 | 低 | 中等 |
| **Docker Compose** | 带监控的完整栈 | 中等 | 中等 |
| **Kubernetes** | 大规模、高可用 | 高 | 复杂 |

选择合适的部署模式来满足你的需求和资源约束。